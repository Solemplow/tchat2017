function creerXHR(){var b=null;if(window.XMLHttpRequest||window.ActiveXObject){if(window.ActiveXObject){try{b=new ActiveXObject("Msxml2.XMLHTTP")}catch(a){b=new ActiveXObject("Microsoft.XMLHTTP")}}else{b=new XMLHttpRequest()}}else{alert("Votre navigateur ne supporte pas l'objet XMLHTTPRequest...");return null}return b}function sendMessage(d){var c=document.querySelector("input.textarea");var a=document.querySelector('input[name="user_id"]').value;var f=document.querySelector("div.name").innerHTML;event.preventDefault();d="texte="+c.value+"&user_id="+a+"&username="+f;console.log(d);var e=creerXHR();var b="ajaxCall.php";e.open("POST",b,true);e.setRequestHeader("Content-type","application/x-www-form-urlencoded");e.onreadystatechange=function(){if(e.readyState==4&&e.status==200){if(e.responseText=="ok"){document.querySelector("ol").innerHTML="";c.value="";getLastsMessage()}}};e.send(d)}function getLastsMessage(){var b=creerXHR();var a="ajaxCall.php?getLastsMessage";b.open("GET",a,true);b.onreadystatechange=function(){if(b.readyState==4&&b.status==200){document.querySelector("ol").innerHTML="";var d=JSON.parse(b.responseText);for(var c=(Object.keys(d).length-1);c>=0;c--){pushLastMessage(d[c].texte,d[c].login,d[c].ladate,false)}}};b.send()}function pushLastMessage(c,d,a,b){if(b===undefined){b=false}messageBox=document.querySelector("ol");messageBox.innerHTML+="<li class='other'><div class='avatar'><img src='http://i.imgur.com/DY6gND0.png' draggable='false'/></div></div><div class='msg'><p id='colorenvoie'>"+d+"</p><p>"+c+"</p><time>"+a+"</time></div></li>";window.scrollTo(0,document.body.scrollHeight+100)}function VerifNbMsg(){var b=creerXHR();var a="ajaxCount.php";b.open("GET",a,true);b.onreadystatechange=function(){if(b.readyState==4&&b.status==200){console.log(b.responseText);if(b.responseText=="charge"){getLastsMessage()}}};b.send()};